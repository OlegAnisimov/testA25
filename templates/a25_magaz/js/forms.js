site.forms={},site.forms.init=function(){var a=jQuery("label.required").closest("form");if(jQuery("input, textarea, select",a).focusout(function(){site.forms.errors.check(this)}),site.forms.data.restore(),site.forms.comments.init(),-1!=location.href.indexOf("forget"))jQuery("#forget input:radio").click(function(){jQuery("#forget input:text").attr("name",jQuery(this).attr("id"))});else if(-1!=location.href.indexOf("purchasing_one_step")){var b=[".customer.onestep",".delivery_address.onestep",".dychoose.onestep",".payment.onestep"],c=jQuery(".without-steps"),d={blocks:b,form:c};site.forms.emarket.purchasingOneStep.init(d)}else-1!=location.href.indexOf("purchase")&&site.forms.emarket.purchase()},site.forms.data={},site.forms.data.save=function(a){if(!a&&!a.id)return!1;var c,d,e,g,b="",f="";for(e=0;e<a.elements.length;e++)if(c=a.elements[e],c.name){switch(d=c.name.replace(/([)\\])/g,"\\$1"),c.type){case"password":break;case"text":case"textarea":b+="TX,"+d+","+c.value;break;case"checkbox":case"radio":b+="CH,"+c.id+","+(c.checked?1:0);break;case"select-one":b+="SO,"+d+","+c.selectedIndex;break;case"select-multiple":for(g=0;g<c.options.length;g++)c.options[g].selected&&(f+=c.options[g].value,g<c.options.length-1&&(f+=":"));b+="SM,"+d+","+f}e<a.elements.length-1&&(b+="+")}return jQuery.cookie("frm"+a.id,b.replace(/([|\\])/g,"\\$1")),!0},site.forms.data.restore=function(){var b,c,d,e,a=jQuery("form");for(b=0;b<a.length;b++)if(a[b].id&&(e=jQuery.cookie("frm"+a[b].id)))for(e=e.split("+"),c=0;c<e.length;c++)if(d=e[c].split(","))switch(d[0]){case"PW":break;case"TX":a[b].elements[d[1]].value=d[2];break;case"CH":document.getElementById(d[1]).checked=1==d[2];break;case"SO":a[b].elements[d[1]].selectedIndex=d[2];break;case"SM":var h,i,f=a[b].elements[d[1]].options,g=d[2].split(":");for(h=0;h<f.length;h++)for(i=0;i<g.length;i++)g[i]&&f[h].value==g[i]&&(f[h].selected=!0)}return!0},site.forms.comments={},site.forms.comments.init=function(){var b,c,a=jQuery("#comments");if("object"==typeof a[0])for(b=jQuery("a.comment_add_link",a[0]),c=0;b.length>c;c++)b[c].onclick=site.forms.comments.add(b[c])},site.forms.comments.add=function(a){return function(){site.forms.comments.setAction(a.id)}},site.forms.comments.setAction=function(a){var b;return!!(b=jQuery("#comment_add_form"))&&(b[0].action="/blogs20/commentAdd/"+a,!0)},site.forms.vote=function(form,vote_id){for(var res=!1,i=0;form.elements.length>i;i++)form.elements[i].checked&&(res=form.elements[i].value);res?(jQuery.ajax({url:"/vote/post/"+res+"/?m="+(new Date).getTime(),dataType:"html",success:function(data){eval(data)}}),jQuery.ajax({url:"/udata://vote/results/"+vote_id+"/?transform=modules/vote/results.xsl&m="+(new Date).getTime(),dataType:"html",success:function(a){var b=jQuery(form.parentNode).html(a);jQuery(".total",b).text(i18n.vote_total_votes)}})):alert(i18n.vote_no_element)},site.forms.errors={},site.forms.errors.check=function(a,b){var c,d=i18n.forms_empty_field;if("required"!=a.parentNode.className)return!1;switch(a.name){case"login":switch(a.value.length){case 0:c=d;break;case 1:case 2:c=i18n.forms_short_login;break;default:a.value.length>40&&(c=i18n.forms_long_login)}break;case"password":switch(a.value.length){case 0:c=d;break;case 1:case 2:c=i18n.forms_short_pass;break;default:a.form.elements.login.value==a.value&&(c=i18n.forms_same_pass)}break;case"password_confirm":0==a.value.length?c=d:a.form.elements.password.value!==a.value&&(c=i18n.forms_confirm_pass);break;case"email":0==a.value.length?c=d:a.value.match(/.+@.+\..+/)||(c=i18n.forms_invalid_email);break;default:0==a.value.length&&(c=d),a.name.match(/^.*e.*mail.*$/)&&"email_to"!=a.name&&"system_email_to"!=a.name&&(a.value.match(/.+@.+\..+/)||(c=i18n.forms_invalid_email))}return b?!c:site.forms.errors.write(c,a)},site.forms.errors.write=function(a,b){var c=b.parentNode.parentNode;if(jQuery("div.formErr",c).remove(),a){var d=document.createElement("div");return d.className="formErr",d.innerHTML=a,c.style.backgroundColor="#ff9999",c.appendChild(d),"password_confirm"==b.name&&(b.value=""),!1}return c.style.backgroundColor="",!0},site.forms.emarket={checkFields:function(a,b){var c=jQuery("label.required input, label.required textarea, label.required select",a).filter(":visible"),d=!0;if(a){for(var e=c.length;e;e--)if(!site.forms.errors.check(c[e-1],b)&&d&&(d=!1,b))return!1;return d}},toggleNewObjectForm:function(a,b){var c=jQuery(b);0!==c.size()&&(jQuery("input[type=radio][value!=new]",a).size()>0&&"new"!==jQuery("input[type=radio]:checked",a).val()&&c.hide(),jQuery("input[type=radio]",a).click(function(){"new"!==jQuery(this).val()?c.hide():c.show()}))},purchase:function(){var a=this;jQuery("input[type=submit]").click(function(b){b.preventDefault();var c=jQuery(this).closest("form");a.checkFields(c)&&c.submit()})}},site.forms.emarket.purchasingOneStep={init:function(a){for(var b=a.blocks,c=a.form,d=[],e=0,f=b.length,g=".delivery_address.onestep",h=".dychoose.onestep",i=a.animate||300,j=0;j<b.length;j++)jQuery(b[j]).length&&d.push(b[j]);f=d.length;for(var j=0;j<d.length;j++)0!==j&&jQuery(d[j],c).hide();jQuery("input[type=radio]",g).click(function(){"self"===jQuery(this).data("type")?jQuery(h,c).hide(i):jQuery(h,c).show(i)}),jQuery("input[type=submit]",c).click(function(a){if(a.preventDefault(),e===f-1&&site.forms.emarket.checkFields(c,!1)&&jQuery(c).submit(),void 0!==d[e+1]&&site.forms.emarket.checkFields(c,!1)){var b=jQuery("input[type=radio][data-type=self]:checked",g).length;d[e]===g&&b&&e++,jQuery(d[e+1],c).show(i),e++}})}},jQuery(document).ready(function(){site.forms.init()});